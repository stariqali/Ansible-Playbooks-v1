---
    - name: Remove 2022-1388 CVE mitigation
      #/////////////////////////////////////////////////////////////////
      #Created by F5 Consultant S. Tariq Ali.
      #Created on 20220913
      #Remove CVE-2022-1388 mitigation using URI module
      #/////////////////////////////////////////////////////////////////
      hosts: corpwpriv
      gather_facts: false
      vars:
        server_port: 443
        validate_certs: false
 
      tasks:
      - name: Remove CVE-2022-1388
        uri:
            url: 'https://{{ ansible_host}}/mgmt/tm/sys/httpd'
            user: "{{ansible_admin}}"
            password: "{{ansible_ssh_pass}}"
            method: PATCH
            body: '{"include": "none"}'
            headers:
              Content-Type: application/json
              return_content: yes
            validate_certs: false
        register: applycve
 
      - name: Display cve mitigation configuration status
        debug:
          var: applycve
 
      - name: Pause for 2 seconds
        pause:
          seconds: 2
 
      - name: Saving config after applying mitigation for CVE-2022-1388
        uri:
            url: 'https://{{ ansible_host}}/mgmt/tm/sys/config'
            user: "{{ansible_admin}}"
            password: "{{ansible_ssh_pass}}"
            method: POST
            body:
              command: save
            body_format: json
            headers:
              Content-Type: application/json
            validate_certs: false
        register: result
 